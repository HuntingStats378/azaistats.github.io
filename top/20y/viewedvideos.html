<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Live Top 50 Videos â€“ 20 Years Ago</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 40px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 20px;
    }
    .video-card {
      background: white;
      border-radius: 10px;
      padding: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }
    .rank {
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .title {
      font-weight: bold;
      margin: 5px 0;
    }
    .thumbnail {
      width: 100%;
      height: auto;
      border-radius: 8px;
      margin-bottom: 5px;
    }
    .views {
      color: #666;
      font-size: 0.9em;
    }
  </style>
</head>
<body>

<h1>Top 50 Most Viewed Videos - 20 Years Ago (Live)</h1>
<div class="grid" id="videoGrid"></div>

<script>
  const videos = [
    {
      id: "vid1",
      title: "Space Cat Rave",
      thumbnail: "https://placekitten.com/320/180",
      views: [
        { timestamp: "2005-04-22T00:00:00Z", count: 1_000_000_000 },
        { timestamp: "2005-04-23T00:00:00Z", count: 10_000_000_000 }
      ]
    },
    {
      id: "vid2",
      title: "Banana Slip Fail",
      thumbnail: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/89/Banana-Single.jpg/320px-Banana-Single.jpg",
      views: [
        { timestamp: "2005-04-22T00:00:00Z", count: 5_000_000_000 },
        { timestamp: "2005-04-23T12:00:00Z", count: 12_000_000_000 }
      ]
    },
    {
      id: "vid3",
      title: "Ultimate Fart Compilation",
      thumbnail: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/50/Wind_cloud.jpg/320px-Wind_cloud.jpg",
      views: [
        { timestamp: "2005-04-22T12:00:00Z", count: 9_000_000_000 },
        { timestamp: "2005-04-23T18:00:00Z", count: 11_000_000_000 }
      ]
    }
  ];

  const container = document.getElementById('videoGrid');
  let previousRanks = {};

  function interpolateViewCount(views, targetTime) {
    const t = new Date(targetTime).getTime();
    const sorted = views.slice().sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));

    for (let i = 0; i < sorted.length - 1; i++) {
      const t1 = new Date(sorted[i].timestamp).getTime();
      const t2 = new Date(sorted[i + 1].timestamp).getTime();
      if (t >= t1 && t <= t2) {
        const v1 = sorted[i].count;
        const v2 = sorted[i + 1].count;
        const ratio = (t - t1) / (t2 - t1);
        return Math.round(v1 + ratio * (v2 - v1));
      }
    }

    if (t < new Date(sorted[0].timestamp)) return sorted[0].count;
    if (t > new Date(sorted[sorted.length - 1].timestamp)) return sorted[sorted.length - 1].count;
  }

  function render() {
    const now = new Date();
    const twentyYearsAgo = new Date(now);
    twentyYearsAgo.setFullYear(now.getFullYear() - 20);

    const ranked = videos.map(video => {
      return {
        ...video,
        interpolatedViews: interpolateViewCount(video.views, twentyYearsAgo)
      };
    }).sort((a, b) => b.interpolatedViews - a.interpolatedViews);

    const newRanks = {};
    ranked.forEach((video, index) => {
      newRanks[video.id] = index;
    });

    container.innerHTML = '';

    ranked.forEach((video, index) => {
      const card = document.createElement('div');
      card.className = 'video-card';
      const imgId = `thumb-${video.id}`;

      let reloadImg = '';
      if (previousRanks[video.id] !== undefined && previousRanks[video.id] !== newRanks[video.id]) {
        // Overtake detected, force image reload
        reloadImg = `?t=${Date.now()}`;
      }

      card.innerHTML = `
        <div class="rank">#${String(index + 1).padStart(2, '0')}</div>
        <img id="${imgId}" src="${video.thumbnail}${reloadImg}" class="thumbnail" alt="Thumbnail">
        <div class="title">${video.title}</div>
        <div class="views">${video.interpolatedViews.toLocaleString()} views</div>
      `;

      container.appendChild(card);
    });

    previousRanks = newRanks;
  }

  render(); // initial render
  setInterval(render, 1000); // update every second
</script>

</body>
</html>
