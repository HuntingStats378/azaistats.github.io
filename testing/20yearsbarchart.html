<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>20 Years Ago Live Chart</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: sans-serif;
      background: #111;
      color: white;
    }
    #chart {
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      height: 100%;
      width: 100%;
      padding: 10px;
    }
    .bar {
      display: flex;
      align-items: center;
      margin: 4px 0;
      height: 40px;
      position: relative;
    }
    .creator {
      width: 80px;
      text-align: right;
      margin-right: 10px;
      font-size: 12px;
      color: #aaa;
      flex-shrink: 0;
    }
    .thumbnail {
      width: 40px;
      height: 40px;
      margin-right: 10px;
      flex-shrink: 0;
      background-size: cover;
      background-position: center;
      border-radius: 4px;
    }
    .bar-inner {
      height: 100%;
      background: gray;
      display: flex;
      align-items: center;
      padding-left: 10px;
      font-weight: bold;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-size: 14px;
      border-radius: 4px;
    }
  </style>
</head>
<body>

<div id="chart"></div>

<script>
const videos = [
  {
    id: "jNQXAC9IVRw",
    title: "Me at the zoo",
    creator: "jawed",
    views: [
      { timestamp: "2005-04-24T03:27:12Z", count: 0 },
      { timestamp: "2006-03-21T12:38:38Z", count: 716 },
      { timestamp: "2006-05-01T20:54:58Z", count: 799 }
    ]
  }
  // Add more video data here...
];

// Helper: Load image and get average color
function getAverageColor(img) {
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = canvas.height = 1;
  ctx.drawImage(img, 0, 0, 1, 1);
  const data = ctx.getImageData(0, 0, 1, 1).data;
  return `rgb(${data[0]},${data[1]},${data[2]})`;
}

// State
const videoStates = {}; // id => {currentViews, color, loaded}
const chart = document.getElementById('chart');

// Initialize thumbnails
videos.forEach(video => {
  const img = new Image();
  img.crossOrigin = "Anonymous";
  img.src = `https://azaistats.github.io/images/thumbnails/${video.id}.jpg`;
  img.onload = () => {
    const color = getAverageColor(img);
    videoStates[video.id] = { currentViews: 0, color: color, loaded: true };
  };
  img.onerror = () => {
    videoStates[video.id] = { currentViews: 0, color: '#888888', loaded: true };
  };
});

// Virtual clock setup
const twentyYearsAgo = new Date();
twentyYearsAgo.setFullYear(twentyYearsAgo.getFullYear() - 20);

function interpolateViews(views, currentTime) {
  if (!views.length) return 0;
  if (new Date(views[0].timestamp) > currentTime) return null;
  
  for (let i = views.length - 1; i >= 0; i--) {
    if (new Date(views[i].timestamp) <= currentTime) {
      return views[i].count;
    }
  }
  return 0;
}

function updateChart() {
  const now = new Date();
  const virtualNow = new Date(now.getTime());
  virtualNow.setFullYear(virtualNow.getFullYear() - 20);

  const activeVideos = [];

  videos.forEach(video => {
    const state = videoStates[video.id];
    if (!state || !state.loaded) return;
    
    const currentViews = interpolateViews(video.views, virtualNow);
    if (currentViews !== null) {
      state.currentViews = currentViews;
      activeVideos.push({ ...video, views: state.currentViews, color: state.color });
    }
  });

  activeVideos.sort((a, b) => b.views - a.views);
  const topVideos = activeVideos.slice(0, 20);

  chart.innerHTML = '';
  const maxViews = Math.max(...topVideos.map(v => v.views), 1);

  topVideos.forEach(video => {
    const bar = document.createElement('div');
    bar.className = 'bar';

    const creator = document.createElement('div');
    creator.className = 'creator';
    creator.textContent = video.creator;

    const thumbnail = document.createElement('div');
    thumbnail.className = 'thumbnail';
    thumbnail.style.backgroundImage = `url(https://azaistats.github.io/images/thumbnails/${video.id}.jpg)`;

    const barInner = document.createElement('div');
    barInner.className = 'bar-inner';
    barInner.style.background = video.color;
    barInner.style.width = `${(video.views / maxViews) * 70 + 30}%`; // At least 30% width

    barInner.textContent = `${video.title} (${Math.round(video.views)})`;

    bar.appendChild(creator);
    bar.appendChild(thumbnail);
    bar.appendChild(barInner);

    chart.appendChild(bar);
  });
}

// Start loop
setInterval(updateChart, 1000);
</script>

</body>
</html>
