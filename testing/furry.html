<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>YouTube Channel Bar Chart Race</title>
  <script src="https://cdn.plot.ly/plotly-2.24.2.min.js"></script>
  <style>
    body { font-family: sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
    #chart { width: 100%; max-width: 1200px; margin: auto; }
    h1 { text-align: center; }
  </style>
</head>
<body>

<h1>Top 20 YouTube Channels by Subscribers</h1>
<div id="chart"></div>

<script>
  const channelIDs = [
    'UCX6OQ3DkcsbYNE6H8uQQuVA', // MrBeast
    'UCq-Fj5jknLsUf-MWSy4_brA', // T-Series
    'UC295-Dw_tDNtZXFeAPAW6Aw', // Cocomelon
    // Add more channel IDs here
  ];

  async function fetchChannelData(id) {
    try {
      const res = await fetch(`https://ests.sctools.org/api/get/${id}`);
      const json = await res.json();
      return {
        id,
        name: json.info.name,
        avatar: json.info.avatar,
        subs: json.stats.estCount,
        daily: json.averages.daily
      };
    } catch (e) {
      console.error(`Failed to fetch ${id}`, e);
      return null;
    }
  }

  async function fetchAllChannels() {
    const results = await Promise.all(channelIDs.map(fetchChannelData));
    return results.filter(Boolean);
  }

  function renderChart(channels) {
    const sorted = channels.sort((a, b) => b.subs - a.subs).slice(0, 20);
    const names = sorted.map(ch => ch.name);
    const subs = sorted.map(ch => ch.subs);
    const hoverText = sorted.map(ch =>
      `${ch.name}<br>Subs: ${ch.subs.toLocaleString()}<br>Daily Avg: ${ch.daily.toLocaleString()}`
    );
    const avatars = sorted.map(ch => ch.avatar);

    const trace = {
      type: 'bar',
      x: subs,
      y: names,
      orientation: 'h',
      text: hoverText,
      textposition: 'auto',
      marker: {
        color: 'rgba(30,144,255,0.6)',
        line: {
          width: 1,
          color: 'rgba(0,0,0,0.3)'
        }
      }
    };

    const layout = {
      title: 'Live Top 20 YouTube Channels by Estimated Subscribers',
      margin: { l: 150, r: 30, t: 50, b: 50 },
      yaxis: {
        automargin: true,
        tickfont: { size: 14 }
      },
      xaxis: {
        title: 'Subscribers',
        tickformat: ',d'
      },
      images: avatars.map((src, i) => ({
        source: src,
        xref: 'paper',
        yref: 'y',
        x: 0,
        y: names[i],
        xanchor: 'right',
        yanchor: 'middle',
        sizex: 0.07,
        sizey: 0.07,
        opacity: 1,
        layer: 'above'
      }))
    };

    Plotly.newPlot('chart', [trace], layout, {responsive: true});
  }

  async function updateChart() {
    const data = await fetchAllChannels();
    renderChart(data);
  }

  // Initial load
  updateChart();

  // Update every 60 seconds
  setInterval(updateChart, 60000);
</script>

</body>
</html>
