<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>YouTube Channel Stats</title>
  <script src="https://cdn.plot.ly/plotly-2.24.2.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 20px;
    }
    h1, h2 {
      text-align: center;
      color: #333;
    }
    .chart-container {
      max-width: 1200px;
      margin: 40px auto;
    }
  </style>
</head>
<body>

  <h1>YouTube Channel Stats</h1>

  <div class="chart-container">
    <h2>ðŸ”´ Top 20 Channels by Subscribers</h2>
    <div id="subs-chart"></div>
  </div>

  <div class="chart-container">
    <h2>ðŸ”µ Top 20 Channels by Daily Average Growth</h2>
    <div id="daily-chart"></div>
  </div>

  <script>
    const channelIDs = [
      'UCX6OQ3DkcsbYNE6H8uQQuVA', // MrBeast
      'UC295-Dw_tDNtZXFeAPAW6Aw', // Cocomelon
      'UCq-Fj5jknLsUf-MWSy4_brA', // T-Series
      'UC-lHJZR3Gqxm24_Vd_AJ5Yw', // PewDiePie
      'UCbCmjCuTUZos6Inko4u57UQ', // Vlad and Niki
      'UCEdvpU2pFRCVqU6yIPyTpMQ', // Zee Music
      // Add more channel IDs as needed
    ];

    async function fetchChannelData(id) {
      try {
        const res = await fetch(`https://ests.sctools.org/api/get/${id}`);
        const json = await res.json();
        return {
          id,
          name: json.info.name,
          avatar: json.info.avatar,
          subs: json.stats.estCount,
          daily: json.averages.daily
        };
      } catch (e) {
        console.error("Failed to fetch data for ID:", id, e);
        return null;
      }
    }

    async function fetchAllChannels() {
      const results = await Promise.all(channelIDs.map(fetchChannelData));
      return results.filter(Boolean);
    }

    function plotChart(data, valueKey, chartId, color) {
      const sorted = [...data].sort((a, b) => b[valueKey] - a[valueKey]).slice(0, 20);
      const names = sorted.map(ch => ch.name);
      const values = sorted.map(ch => ch[valueKey]);
      const avatars = sorted.map(ch => ch.avatar);
      const hoverText = sorted.map(ch =>
        `${ch.name}<br>Subs: ${ch.subs.toLocaleString()}<br>Daily Avg: ${ch.daily.toLocaleString()}`
      );

      const trace = {
        type: 'bar',
        x: values,
        y: names,
        orientation: 'h',
        text: hoverText,
        textposition: 'auto',
        marker: {
          color: color,
          line: {
            width: 1,
            color: 'rgba(0,0,0,0.2)'
          }
        }
      };

      const layout = {
        margin: { l: 180, r: 50, t: 30, b: 50 },
        yaxis: {
          automargin: true,
          autorange: 'reversed', // Highest on top
          tickfont: { size: 14 }
        },
        xaxis: {
          tickformat: ',d'
        },
        images: avatars.map((src, i) => ({
          source: src,
          xref: 'paper',
          yref: 'y',
          x: 0,
          y: names[i],
          xanchor: 'right',
          yanchor: 'middle',
          sizex: 0.07,
          sizey: 0.07,
          opacity: 1,
          layer: 'above'
        }))
      };

      Plotly.newPlot(chartId, [trace], layout, {responsive: true});
    }

    async function updateCharts() {
      const data = await fetchAllChannels();
      plotChart(data, 'subs', 'subs-chart', 'rgba(255,99,132,0.6)');
      plotChart(data, 'daily', 'daily-chart', 'rgba(54,162,235,0.6)');
    }

    // Initial load
    updateCharts();

    // Refresh every 60 seconds
    setInterval(updateCharts, 2000);
  </script>

</body>
</html>
